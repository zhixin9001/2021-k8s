Kubernetes笔记(10) - 资源指标及HPA控制器

资源监控系统是容器编排系统必不可少的组件，它为用户提供了快速了解系统资源分配和利用状态的有效途径，同时也是系统编排赖以实现的基础要件。Kubernetes将资源指标的规范及其实现分离开来，为用户提供了极大的扩展空间。

### 资源监控及资源指标
Kubernetes有多个数据指标需要采集相关的数据，而这些指标大体上可以分为两个主要组成部分：监控集群本身和监控Pod对象。
在集群监控层面，目标是监控整个Kubernetes集群的健康状况，包括如下指标：
- 节点资源状态：与资源利用状况有关，主要有网络带宽、磁盘空间、CPU和内存的利用率；基于这些度量指标，管理员能够评估集群规模的合理性
- 节点数量：公有云服务一般以客户使用实例数量来计算费用
- 运行的Pod对象：正在运行的Pod对象数量能够用于评估可用节点的数量是否足够，以及在节点发生故障时它们是否能够承接整个工作负载。

Pod资源对象的监控需求大体上可以分为下面三类：
- Kubernetes指标：用于监视特定应用程序相关的Pod对象的部署过程、当前副本数量、期望的副本数量、部署过程进展状态、健康状态监测及网络服务器的可用性等，这些指标数据需要经由Kubernetes系统接口获取。
- 容器指标：容器的资源需求、资源限制以及CPU、内存、磁盘空间、网络带宽等资源的实际占用状况等。
- 应用程序指标：应用程序自身内建的指标，通常与其所处理的业务规则相关。


#### Kubernetes的监控架构
Kubernetes的监控架构将监控指标分为核心指标和自定义指标两类
- 核心指标由kubelet、资源评估器、metrics-server以及由API Server提供的API群组（由APIService对象提供）组成，它们可用于为Kubernetes系统提供核心指标，从而能够了解并操作其内部组件和核心程序。截至目前，相关的指标主要包括CPU累计使用、内存即时使用率、Pod的资源占用率及容器的磁盘占用率等几个
- 自定义指标用于从系统收集各种指标数据并提供给终端用户、存储系统以及HPA控制器等使用，允许用户扩展任意数量的特定于应用程序的指标

核心指标和自定义指标分别对应资源指标API和自定义指标API，它们都只是都仅是API的定义和规范，它们自身都并非具体的API实现。目前，资源指标API的实现较主流是的metrics-server，而自定义指标API则以建构在监控系统Prometheus之上的k8s-prometheus-adapter最广为接受。

一个能同时使用资源指标API和自定义指标API的组件是第二版的HorizontalPod-Autoscaler控制器（HPAv2），它实现了基于观察到的指标自动缩放Deployment或ReplicaSet类型控制器管控下的Pod副本数量。

### 核心指标及其应用










